# 07 - مخطط الدوائر الكهربائية | Circuit Plan

## الرسم التخطيطي العام للمشروع ⚡

### نظرة شاملة على النظام مع الطاقة الشمسية ☀️🔌

```
        ☀️ نظام الطاقة الشمسية المتجددة ☀️
                           |
      ┌──────────────────────────────────────────────┐
      │  🌞 ألواح شمسية (6V 2W × 2)               │
      │           ↓                                  │
      │  🔋 نظام البطاريات (18650 × 4)             │
      │           ↓                                  │
      │  ⚡ منظم الجهد وإدارة الطاقة                │
      │           ↓                                  │
      │  🔌 مركز توزيع الطاقة الذكي                │
      └──────────────────┬───────────────────────────┘
                         │
                    ESP32 DevKit (الدماغ المركزي)
                         │
        ┌─────────────────────────────────────────┐
        |                                         |
    [أجهزة الاستشعار]                        [أجهزة الإخراج]
        |                                         |
    🌡️ DHT22 ────────────┐                    ┌─── 💡 مصابيح LED
    👥 PIR Sensors ──────┤                    ├─── 🔊 Buzzer  
    💡 LDR Sensors ──────┤── ESP32 GPIO ──────┤─── 📺 LCD Display
    📏 Ultrasonic ───────┤                    ├─── 🔄 Servo Motors
    💨 MQ-2 Gas ─────────┤                    ├─── 🌀 Fan Motor
    📊 Voltage Sensor ───┘                    └─── 🚨 Power LEDs
```

## مخطط توصيل ESP32 بالتفصيل 📋

### أرقام المنافذ (GPIO Pins) المستخدمة:

| المنفذ | المكون | النوع | الوصف |
|--------|--------|-------|-------|
| **GPIO 2** | LED Built-in | Output | مؤشر حالة النظام |
| **GPIO 4** | DHT22 | Input | بيانات الحرارة والرطوبة |
| **GPIO 5** | PIR Sensor 1 | Input | حساس حركة غرفة المعيشة |
| **GPIO 12** | PIR Sensor 2 | Input | حساس حركة المدخل |
| **GPIO 13** | LDR Sensor 1 | Input | حساس ضوء النافذة |
| **GPIO 14** | LDR Sensor 2 | Input | حساس ضوء المطبخ |
| **GPIO 15** | MQ-2 Gas Sensor | Input | حساس الغاز والدخان |
| **GPIO 16** | Ultrasonic Echo | Input | استقبال إشارة المسافة |
| **GPIO 17** | Ultrasonic Trig | Output | إرسال إشارة المسافة |
| **GPIO 18** | LED Strip 1 | Output | إضاءة غرفة المعيشة |
| **GPIO 19** | LED Strip 2 | Output | إضاءة المطبخ |
| **GPIO 21** | LCD SDA | I2C | بيانات الشاشة |
| **GPIO 22** | LCD SCL | I2C | ساعة الشاشة |
| **GPIO 23** | Servo Motor 1 | Output | باب رئيسي |
| **GPIO 25** | Servo Motor 2 | Output | نافذة ذكية |
| **GPIO 26** | Buzzer | Output | نظام الإنذار |
| **GPIO 27** | Fan Motor | Output | نظام التهوية |
| **GPIO 32** | Voltage Sensor | Input | مراقبة مستوى البطارية |
| **GPIO 33** | Solar Power LED | Output | مؤشر الطاقة الشمسية |
| **GPIO 34** | Battery Low LED | Output | مؤشر البطارية منخفضة |
| **GPIO 35** | System Power LED | Output | مؤشر حالة النظام |
| **3.3V** | مصدر طاقة | Power | تغذية الحساسات |
| **5V** | مصدر طاقة | Power | تغذية المحركات |
| **VIN** | مدخل الطاقة | Power | من نظام الطاقة الشمسية |
| **GND** | الأرضي | Ground | مرجع الجهد |

## الدوائر الفرعية بالتفصيل 🔧

### 1. دائرة حساس الحرارة والرطوبة (DHT22)

```
ESP32                    DHT22
──────                  ────────
GPIO 4  ───────────────  DATA (Pin 2)
3.3V    ───────────────  VCC  (Pin 1)
GND     ───────────────  GND  (Pin 4)
                        
مقاومة 10kΩ بين VCC و DATA (Pull-up)
```

**شرح التوصيل:**
- 🔴 **الطاقة**: 3.3V من ESP32 إلى Pin 1 في DHT22
- ⚫ **الأرضي**: GND من ESP32 إلى Pin 4 في DHT22  
- 🟡 **البيانات**: GPIO 4 إلى Pin 2 في DHT22
- 🟤 **مقاومة**: 10kΩ بين الطاقة والبيانات

### 2. دائرة حساس الحركة (PIR)

```
ESP32                    PIR Sensor
──────                  ──────────
GPIO 5  ───────────────  OUT
5V      ───────────────  VCC
GND     ───────────────  GND

```

**ملاحظات مهمة:**
- ⚡ يحتاج PIR إلى 5V للعمل بكفاءة
- 📡 نطاق الاستشعار: 3-7 متر
- ⏰ زمن التأخير قابل للتعديل

### 3. دائرة حساس الضوء (LDR)

```
ESP32                    LDR Circuit
──────                  ─────────────
GPIO 13 ─────┬─────────  وسط المقسم
             │
            LDR
             │
            3.3V
             │
           مقاومة 10kΩ  
             │
            GND
```

**طريقة العمل:**
- 🌞 **ضوء قوي**: مقاومة LDR تقل → جهد أعلى على GPIO
- 🌙 **ضوء ضعيف**: مقاومة LDR تزيد → جهد أقل على GPIO

### 4. دائرة مصابيح LED

```
ESP32                    LED Circuit
──────                  ─────────────
GPIO 18 ─── مقاومة 220Ω ─── LED Anode (+)
                            LED Cathode (-) ─── GND
```

**حساب المقاومة:**
- جهد ESP32: 3.3V
- جهد LED: 2.0V (أحمر) / 3.0V (أزرق)
- تيار LED: 20mA
- المقاومة = (3.3V - 2.0V) / 0.02A = 65Ω
- **نستخدم 220Ω للأمان**

### 5. دائرة محرك Servo

```
ESP32                    Servo Motor
──────                  ─────────────
GPIO 23 ───────────────  Signal (أصفر)
5V      ───────────────  VCC (أحمر)
GND     ───────────────  GND (بني/أسود)
```

### 6. دائرة الشاشة LCD (I2C)

```
ESP32                    LCD Display
──────                  ─────────────
GPIO 21 ───────────────  SDA
GPIO 22 ───────────────  SCL  
5V      ───────────────  VCC
GND     ───────────────  GND
```

### 7. دائرة نظام الطاقة الشمسية والبطاريات ☀️🔋

```
┌─ الألواح الشمسية ─┐     ┌─ نظام إدارة البطاريات ─┐     ┌─ ESP32 ─┐
│  🌞 Panel 1 (6V)  │     │                           │     │          │
│      +    -       │────▶│ BMS (حماية البطاريات)     │────▶│ VIN      │
│  🌞 Panel 2 (6V)  │     │           ↓               │     │          │
└─────────────────────┘     │ 🔋🔋🔋🔋 (4×18650)        │     │ GPIO 32  │←── قراءة الجهد
                            │           ↓               │     │          │
                            │ ⚡ منظم الجهد (12V→5V)    │     │ GPIO 33  │←── LED أخضر (شمسي)
                            │           ↓               │     │          │
                            │ 🔌 مفتاح تبديل الطاقة    │     │ GPIO 34  │←── LED أحمر (بطارية)
                            └───────────────────────────┘     │ GPIO 35  │←── LED أزرق (نظام)
                                                              └──────────┘

مصدر الطاقة الاحتياطي:
USB/محول كهرباء ──── مفتاح التبديل ──── ESP32 VIN
```

**مواصفات النظام:**
- 🔋 **سعة البطاريات**: 4 × 3000mAh = 12Ah
- ☀️ **قدرة الألواح**: 2 × 2W = 4W إجمالي  
- ⚡ **جهد النظام**: 12V (بطاريات) → 5V (ESP32)
- 🕐 **وقت التشغيل**: 8-12 ساعة (حسب الاستخدام)

### 8. دائرة حساس مراقبة البطارية

```
ESP32                    Voltage Divider
──────                  ─────────────────
GPIO 32 ─────┬─────────  وسط المقسم
             │
           مقاومة 10kΩ
             │
        Battery 12V (+)
             │
           مقاومة 10kΩ  
             │
            GND
```

**حساب مستوى البطارية:**
- جهد كامل: 16.8V (4.2V × 4)
- جهد منخفض: 12.4V (3.1V × 4)  
- جهد القراءة: (Battery Voltage × 10kΩ) / (10kΩ + 10kΩ) = Battery Voltage / 2

## قواعد الأمان في التوصيل ⚠️

### 1. قبل التوصيل:
- [ ] ✅ تأكد من فصل الطاقة
- [ ] ✅ تحقق من أرقام المنافذ
- [ ] ✅ راجع قطبية المكونات
- [ ] ✅ تأكد من المقاومات المطلوبة

### 2. أثناء التوصيل:
- [ ] 🔌 استخدم أسلاك بألوان مختلفة (أحمر للطاقة، أسود للأرضي)
- [ ] 📏 لا تترك أسلاك عارية تتلامس
- [ ] 🔧 تأكد من إحكام التوصيلات
- [ ] 📋 اتبع المخطط خطوة بخطوة

### 3. بعد التوصيل:
- [ ] 🔍 راجع جميع التوصيلات مرتين
- [ ] ⚡ اختبر بجهد منخفض أولاً
- [ ] 🧪 اختبر كل مكون على حدة
- [ ] 📊 سجل أي مشاكل أو ملاحظات

### 4. أمان البطاريات والطاقة الشمسية ⚠️🔋:
- [ ] 🚨 **لا تقصر دائرة البطاريات مطلقاً** - خطر حريق!
- [ ] ⚡ تأكد من قطبية البطاريات (+) و (-) صحيحة
- [ ] 🌡️ لا تعرض البطاريات للحرارة الزائدة
- [ ] 💧 احم البطاريات من الماء والرطوبة
- [ ] 🔧 استخدم BMS دائماً لحماية البطاريات
- [ ] 🚪 في حالة انتفاخ البطارية - اتصل بالمعلم فوراً
- [ ] 🧯 أبقِ مطفأة الحريق قريباً من منطقة العمل
- [ ] 👥 لا تعمل مع البطاريات بمفردك

## نصائح التوصيل العملية 💡

### 1. تنظيم الأسلاك:
```
ألوان الأسلاك المقترحة:
🔴 أحمر    → طاقة موجبة (3.3V, 5V)
⚫ أسود    → أرضي (GND)
🟡 أصفر    → إشارات رقمية
🟢 أخضر    → إشارات تماثلية
🔵 أزرق    → اتصالات I2C
⚪ أبيض    → اتصالات أخرى
```

### 2. ترتيب التوصيل:
1. **البداية**: وصل الأرضي (GND) أولاً
2. **الطاقة**: وصل خطوط الطاقة (3.3V, 5V)
3. **الإشارات**: وصل خطوط البيانات أخيراً
4. **الفحص**: اختبر كل مجموعة قبل الانتقال للتالية

### 3. أدوات مساعدة:
- 🏷️ **ملصقات**: لتسمية الأسلاك
- 📐 **مسطرة**: لقياس أطوال الأسلاك
- ✂️ **قاطع أسلاك**: لتقطيع بالطول المناسب
- 🔍 **عدسة مكبرة**: لفحص التوصيلات الدقيقة

## اختبار الدوائر خطوة بخطوة 🧪

### المرحلة 1: اختبار الطاقة
```cpp
// كود اختبار بسيط
void setup() {
  Serial.begin(115200);
  pinMode(2, OUTPUT); // LED المدمج
}

void loop() {
  digitalWrite(2, HIGH);
  Serial.println("LED ON");
  delay(1000);
  digitalWrite(2, LOW);
  Serial.println("LED OFF");
  delay(1000);
}
```

### المرحلة 2: اختبار الحساسات
```cpp
// اختبار حساس الحرارة
#include "DHT.h"
DHT dht(4, DHT22);

void setup() {
  Serial.begin(115200);
  dht.begin();
}

void loop() {
  float temp = dht.readTemperature();
  float hum = dht.readHumidity();
  
  Serial.print("درجة الحرارة: ");
  Serial.print(temp);
  Serial.print("°C, الرطوبة: ");
  Serial.print(hum);
  Serial.println("%");
  
  delay(2000);
}
```

### المرحلة 3: اختبار المحركات
```cpp
// اختبار محرك Servo
#include <ESP32Servo.h>
Servo myServo;

void setup() {
  myServo.attach(23);
}

void loop() {
  myServo.write(0);   // 0 درجة
  delay(1000);
  myServo.write(90);  // 90 درجة
  delay(1000);
  myServo.write(180); // 180 درجة
  delay(1000);
}
```

### المرحلة 4: اختبار نظام الطاقة الشمسية ☀️
```cpp
// اختبار نظام الطاقة والبطاريات
#define VOLTAGE_PIN 32
#define SOLAR_LED 33
#define BATTERY_LED 34
#define SYSTEM_LED 35

void setup() {
  Serial.begin(115200);
  pinMode(SOLAR_LED, OUTPUT);
  pinMode(BATTERY_LED, OUTPUT);
  pinMode(SYSTEM_LED, OUTPUT);
}

void loop() {
  // قراءة جهد البطارية
  int voltageReading = analogRead(VOLTAGE_PIN);
  float batteryVoltage = (voltageReading * 3.3 / 4095) * 2; // مضاعف المقسم
  
  Serial.print("جهد البطارية: ");
  Serial.print(batteryVoltage);
  Serial.println("V");
  
  // فحص حالة النظام
  if (batteryVoltage > 15.0) {
    // بطارية ممتلئة - إضاءة خضراء
    digitalWrite(SOLAR_LED, HIGH);
    digitalWrite(BATTERY_LED, LOW);
    Serial.println("🟢 النظام يعمل بالطاقة الشمسية");
  } else if (batteryVoltage > 13.0) {
    // بطارية جيدة - إضاءة زرقاء
    digitalWrite(SYSTEM_LED, HIGH);
    digitalWrite(BATTERY_LED, LOW);
    Serial.println("🔵 النظام يعمل بالبطارية");
  } else {
    // بطارية منخفضة - إضاءة حمراء
    digitalWrite(BATTERY_LED, HIGH);
    digitalWrite(SOLAR_LED, LOW);
    digitalWrite(SYSTEM_LED, LOW);
    Serial.println("🔴 تحذير: البطارية منخفضة!");
  }
  
  delay(2000);
}
```

## حل مشاكل الدوائر الشائعة 🔧

| المشكلة | السبب المحتمل | الحل |
|---------|---------------|------|
| **لا يعمل المكون** | طاقة منقطعة | تحقق من توصيل VCC و GND |
| **قراءات خاطئة** | إشارة مشوشة | أضف مقاومة pull-up/down |
| **ESP32 لا يستجيب** | دائرة قصيرة | افحص التوصيلات وأزل القصر |
| **محرك لا يتحرك** | جهد غير كاف | استخدم مصدر طاقة خارجي |
| **حساس لا يقرأ** | منفذ خاطئ | تأكد من رقم GPIO في الكود |

## المرحلة النهائية: التوصيل الكامل 🔗

عندما تكتمل جميع الدوائر الفرعية:

1. **📋 راجع المخطط العام** مرة أخيرة
2. **🔌 اختبر كل نظام منفرد** قبل الربط
3. **🤝 ادمج الأنظمة تدريجياً** نظام تلو الآخر  
4. **🧪 اختبر النظام الكامل** مع الكود النهائي
5. **📝 وثق أي تغييرات** في المخطط

تذكروا: الصبر والدقة في التوصيل سيوفران عليكم ساعات من البحث عن المشاكل لاحقاً! ⚡🏠 